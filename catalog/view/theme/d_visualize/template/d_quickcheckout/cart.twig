<div id="cart_view" class="qc-step" data-col="{{ col }}" data-row="{{ row }}"></div>
<script type="text/html" id="cart_template">

	<div class="qc-step-section <%= parseInt(model.config.display) ? '' : 'hidden' %>">

			<h4 class="subsection-heading">
				<span class="icon">
					<i class="<%= model.config.icon %>"></i>
				</span>
				<span class="text"><%= model.config.title %> <%= (model.cart_weight) ? '('+model.cart_weight+')' : '' %></span>
			</h4>

		<div class="qc-checkout-product" >
			<% if(model.config.description){ %><p class="text"><%= model.config.description %></p><% } %>
			<% if(model.error){ %>
				<% if(model.config_stock_warning){ %>
					<div class="save-alert save-alert-danger">
						<i class="fa fa-exclamation-circle"></i> <%= model.error %>
					</div>
				<% } else { %>
					<div class="alert alert-danger">
						<i class="fa fa-exclamation-circle"></i> <%= model.error %>
					</div>
				<% } %>
			<% } %>

			<div class="row cart qc-cart">
				<div class="col-md-12 cart_header">
					<div class="row">
						<div class="col-md-2 cart_cell cart_cell--image cart_cell--image-text <%= parseInt(model.config.columns.image) ? '' : 'hidden' %>"><span>{{ column_image }}</span></div>
						<div class="col-md-4 cart_cell cart_cell--description cart_cell--description-text <%= parseInt(model.config.columns.name) ? '' : 'hidden' %>"><span>{{ column_name }}</span></div>
						<div class="col-md-2 cart_cell cart_cell--size cart_cell--size-text"><span>Размер</span></div>
						<div class="col-md-4 cart_cell cart_cell--price cart_cell--price-text <%= parseInt(model.config.columns.price) && model.show_price ? '' : 'hidden' %>">{{ column_price }}</div>
					</div>
				</div>

				<div class="col-md-12 cart_body">
					<% _.each(model.products, function(product) { %>
					<div <%= product.stock ? 'class="row cart_item"' : 'class="stock"' %>>
						<div class="qc-image col-md-2 cart_cell cart_cell--image pl-0 <%= parseInt(model.config.columns.image) ? '' : 'hidden' %>">
							<a href="<%= product.href %>" class="image-wrap" data-container="body" data-toggle="popover" data-placement="top" data-content='<img src="<%= product.image %>" />' data-trigger="hover">
								<img src="<%= product.image %>" class="image img-responsive"/>
							</a>
						</div>

						<div class="qc-name col-md-4 cart_cell cart_cell--description <%= parseInt(model.config.columns.name) ? '' : 'hidden' %>">
							<a href="<%= product.href %>" <%=  model.config.columns.image ? '' : 'rel="popup" data-help=\'<img src=""/>\'' %>>
								<%= product.name %> <%= product.stock ? '' : '<span class="out-of-stock">***</span>' %>
							</a>
							<% _.each(product.option, function(option) { %>
								<div> &nbsp;<small> - <%= option.name %>: <%= option.value %></small> </div>
							<% }) %>
							<% if(parseInt(model.config.columns.model)){ %>
								<div class="qc-name-model visible-xs-block"><small><span class="title">{{ column_model }}:</span> <span class="text"><%= product.model %></span></small></div>
							<% } %>
							<% if(parseInt(model.config.columns.price) && model.show_price){ %>
								<div class="qc-name-price visible-xs-block "><small><span class="title">{{ column_price }}:</span> <span class="text"><%= product.price %></span></small></div>
							<% } %>
							<% if (product.reward) { %>
								<div><small><%= product.reward %></small></div>
							<% } %>
							<% if (product.recurring) { %>
								<div><span class="label label-info">{{ text_recurring_item }}</span> <small><%= product.recurring %></small></div>
							<% } %>
							<span><%= product.model %></span>
							<div class="qc-quantity cart_cell cart_cell--quantity <%= parseInt(model.config.columns.quantity) ? '' : 'hidden' %>">
								<div class="product-quantity">
									<button class="quantity-control decrement" data-product="<%= product.key %>"><i class="far fa-minus"></i></button>
									<input type="text" data-mask="9?999999999999999" value="<%= product.quantity %>" class="qc-product-qantity field quantity-control" name="cart.<%= product.key %>"  data-refresh="2"/>
									<button class="quantity-control increment" data-product="<%= product.key %>"><i class="far fa-plus"></i></button>
								</div>
								<button class="cart-delete-product" data-product="<%= product.key %>"><i class="far fa-close"></i></button>
							</div>
						</div>
						<div class="col-md-2"></div>
						<div class="col-md-4 cart_cell cart_cell--price hidden-xs <%= parseInt(model.config.columns.price) && model.show_price  ? '' : 'hidden' %>">
							<div class="price-wrapper">
								<span class="item_price item_price--actual"><%= product.price %></span>
							</div>
						</div>
						<div class="col-md-2 cart_cell cart_cell--price <%= parseInt(model.config.columns.total) && model.show_price  ? '' : 'hidden' %>"><%= product.total %></div>
					</div>
					<% }) %>
					<% _.each(model.vouchers, function(voucher) { %>
			        <div>
			          <div class="qc-image <%= parseInt(model.config.columns.image) ? '' : 'hidden' %> "></div>
			          <div class="qc-name <%= parseInt(model.config.columns.name) ? '' : 'hidden' %> "><%= voucher.description %></div>
			          <div class="qc-model <%= parseInt(model.config.columns.model) ? '' : 'hidden' %> "></div>
			          <div class="qc-quantity <%= parseInt(model.config.columns.quantity) ? '' : 'hidden' %> ">1</div>
			          <div class="qc-price <%= parseInt(model.config.columns.price) && model.show_price ? '' : 'hidden' %> "><%= voucher.amount %></div>
			        </div>
			        <% }) %>

				</div>
			</div>

			<div class="form-horizontal">
				<div class=" form-group qc-coupon <%= parseInt(model.config.option.coupon.display) ? '' : 'hidden' %>">
					<% if(model.errors.coupon){ %>
						<div class="col-sm-12">
							<div class="alert alert-danger">
								<i class="fa fa-exclamation-circle"></i> <%= model.errors.coupon %>
							</div>
						</div>
					<% } %>
					<% if(model.successes.coupon){ %>
						<div class="col-sm-12">
							<div class="alert alert-success">
								<i class="fa fa-exclamation-circle"></i> <%= model.successes.coupon %>
							</div>
						</div>
					<% } %>
					<label class="col-sm-4 control-label" >
						{{ text_use_coupon }}
					</label>
					<div class="col-sm-8">
						<div class="input-group">
							<input type="text" value="<%= model.coupon ? model.coupon : '' %>" name="coupon" id="coupon" <% if(Number(config.design.placeholder)) {  %>placeholder="{{ text_use_coupon }}" <% } %>  class="field"/>
							<span class="input-group-btn">
								<button class="btn btn-primary" id="confirm_coupon" type="button"><i class="fa fa-check"></i></button>
							</span>
						</div>
					</div>
					<% _.each(model.coupon, function(voucher) { %>

			        <% }) %>
				</div>
				<div class=" form-group qc-voucher <%= parseInt(model.config.option.voucher.display) ? '' : 'hidden' %>">
					<% if(model.errors.voucher){ %>
						<div class="col-sm-12">
							<div class="alert alert-danger">
								<i class="fa fa-exclamation-circle"></i> <%= model.errors.voucher %>
							</div>
						</div>
					<% } %>
					<% if(model.successes.voucher){ %>
						<div class="col-sm-12">
							<div class="alert alert-success">
								<i class="fa fa-exclamation-circle"></i> <%= model.successes.voucher %>
							</div>
						</div>
					<% } %>

					<label class="col-sm-4 control-label" >
						{{ text_use_voucher }}
					</label>
					<div class="col-sm-8">
						<div class="input-group">
							<input type="text" value="<%= model.voucher ? model.voucher : '' %>" name="voucher" id="voucher" <% if(Number(config.design.placeholder)) {  %>placeholder="{{ text_use_voucher }}" <% } %>  class="field"/>
							<span class="input-group-btn">
								<button class="btn btn-primary" id="confirm_voucher" type="button"><i class="fa fa-check"></i></button>
							</span>
						</div>
					</div>
				</div>
				<% if(model.reward_points) { %>
					<div class=" form-group qc-reward <%= parseInt(model.config.option.reward.display) ? '' : 'hidden' %>">
						<% if(model.errors.reward){ %>
							<div class="col-sm-12">
								<div class="alert alert-danger">
									<i class="fa fa-exclamation-circle"></i> <%= model.errors.reward %>
								</div>
							</div>
						<% } %>
						<% if(model.successes.reward){ %>
							<div class="col-sm-12">
								<div class="alert alert-success">
									<i class="fa fa-exclamation-circle"></i> <%= model.successes.reward %>
								</div>
							</div>
						<% } %>
						<label class="col-sm-4 control-label" >
							<%= model.text_use_reward %>
						</label>
						<div class="col-sm-8">
							<div class="input-group">
								<input type="text" value="<%= model.reward ? model.reward : '' %>" name="reward" id="reward" <% if(Number(config.design.placeholder)) {  %>placeholder="<%= model.text_use_reward %>" <% } %> class="field"/>
								<span class="input-group-btn">
									<button class="btn btn-primary" id="confirm_reward" type="button"><i class="fa fa-check"></i></button>
								</span>

							</div>
							<small><%= model.entry_reward %></small>
						</div>

				</div>
				<% } %>
			<% if(model.show_price){ %>
			<div class="form-horizontal qc-totals">
				<% _.each(model.totals, function(total) { %>
				<div class="row">
					<label class="col-sm-9 col-xs-6 control-label" ><%= total.title %></label>
					<div class="col-sm-3 col-xs-6 field-static text-right"><%= total.text %></div>
				</div>
				<% }) %>
			</div>
			<% } %>
			<div class="preloader row"><img class="icon" src="image/<%= config.general.loader %>" /></div>

		</div>
	</div>

</script>
<script>
$(function() {
	qc.cart = $.extend(true, {}, new qc.Cart({{ json }}));
	qc.cartView = $.extend(true, {}, new qc.CartView({
		el:$("#cart_view"),
		model: qc.cart,
		template: _.template($("#cart_template").html())
	}));

});

</script>